<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IB Chem 2.3: Metallic Bonding Master</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --accent: #f59e0b;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text: #0f172a;
            --success: #10b981;
            --error: #ef4444;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        .container { max-width: 1100px; margin: 0 auto; padding: 20px; }

        /* --- HEADER & NAV --- */
        header {
            text-align: center;
            background: var(--card-bg);
            padding: 30px;
            border-radius: 0 0 20px 20px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .nav-bar {
            display: flex; justify-content: center; gap: 15px; margin-bottom: 30px; flex-wrap: wrap;
        }
        .nav-btn {
            padding: 12px 25px; border: none; background: white; color: #64748b; border-radius: 50px;
            cursor: pointer; font-weight: 700; transition: all 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex; align-items: center; gap: 8px;
        }
        .nav-btn:hover { transform: translateY(-2px); color: var(--primary); }
        .nav-btn.active { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3); }

        .section { display: none; animation: fadeIn 0.4s ease-in-out; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity:0; transform: translateY(10px);} to { opacity:1; transform:translateY(0);} }

        /* --- TUTORIAL SLIDES --- */
        .slide-container {
            background: white; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden; position: relative; min-height: 550px; display: flex; flex-direction: column;
        }
        .slide { display: none; padding: 40px; flex-grow: 1; }
        .slide.active-slide { display: block; animation: slideIn 0.5s; }
        @keyframes slideIn { from { opacity:0; transform: translateX(20px); } to { opacity:1; transform: translateX(0); } }

        .slide-footer {
            padding: 20px; background: #f8fafc; border-top: 1px solid #e2e8f0;
            display: flex; justify-content: space-between; align-items: center;
        }
        .slide-dots { display: flex; gap: 8px; }
        .dot { width: 10px; height: 10px; background: #cbd5e1; border-radius: 50%; }
        .dot.active { background: var(--primary); transform: scale(1.2); }

        /* Tutorial Visuals */
        .step-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 20px; }
        .step-card { padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0; background: #f8fafc; text-align: center; }
        .step-card h3 { margin-top: 0; color: var(--primary); }
        .checkpoint-box { background: #e0f2fe; border: 2px solid #bae6fd; border-radius: 10px; padding: 20px; margin-top: 20px; }

        /* Electron Sea Animation */
        .lattice-container {
            position: relative; width: 100%; height: 180px; background: #eff6ff; border-radius: 10px; margin: 20px 0; overflow: hidden;
        }
        .metal-ion {
            width: 40px; height: 40px; background: #94a3b8; border-radius: 50%; position: absolute;
            display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; border: 2px solid #475569; z-index: 2;
        }
        .electron {
            width: 6px; height: 6px; background: #ef4444; border-radius: 50%; position: absolute; z-index: 1;
            animation: floatAround 4s infinite linear;
        }
        @keyframes floatAround { 0% { transform: translate(0,0); } 50% { transform: translate(10px,15px); } 100% { transform: translate(0,0); } }

        /* --- LAB EXPLORER --- */
        .pt-grid { display: grid; grid-template-columns: repeat(18, 1fr); gap: 4px; margin-bottom: 20px; }
        .element-box {
            aspect-ratio: 1; background: white; border: 1px solid #cbd5e1; border-radius: 4px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; font-size: 0.85rem; transition: all 0.2s;
        }
        .element-box:hover { transform: scale(1.2); z-index: 10; box-shadow: 0 2px 8px rgba(0,0,0,0.2); border-color: var(--primary); }
        .element-box.selected { background: var(--primary); color: white; border-color: var(--primary-dark); }
        
        .g1 { background: #fee2e2; } .g2 { background: #ffedd5; } .tm { background: #e0f2fe; } .g13 { background: #dcfce7; }

        .viz-container { display: flex; gap: 30px; align-items: center; justify-content: center; height: 120px; margin-top: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .circle { border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; transition: all 0.5s ease; }

        /* --- QUIZ STYLES --- */
        .quiz-layout { display: grid; grid-template-columns: 1fr; gap: 20px; }
        .q-card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .opt-btn { width: 100%; padding: 15px; margin-bottom: 10px; border: 1px solid #e2e8f0; border-radius: 8px; text-align: left; cursor: pointer; background: #f8fafc; transition: 0.2s; font-size: 1rem; }
        .opt-btn:hover { border-color: var(--primary); background: #eff6ff; }
        .opt-btn.correct { background: #dcfce7; border-color: var(--success); }
        .opt-btn.wrong { background: #fee2e2; border-color: var(--error); }

        /* --- PRINT / PDF STYLES --- */
        @media print {
            body { background: white; color: black; }
            .nav-bar, header, #tutorial, #explorer, #quiz { display: none !important; }
            #results { display: block !important; }
            .print-hide { display: none !important; }
            .container { width: 100%; max-width: 100%; margin: 0; padding: 0; }
            .result-card { border: 1px solid #000; box-shadow: none; break-inside: avoid; }
            button { display: none; }
        }

        .result-card { background: white; padding: 25px; border-radius: 10px; margin-bottom: 15px; border-left: 5px solid var(--primary); }
        .mistake-tag { display: inline-block; background: #fee2e2; color: #991b1b; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: bold; margin-right: 5px; }

    </style>
</head>
<body>

<div class="container">
    <header>
        <h1><i class="fas fa-atom"></i> Metallic Bonding Master</h1>
        <p>Structure 2.3: Tutorial, Visualizer & Quiz</p>
    </header>

    <nav class="nav-bar">
        <button class="nav-btn active" onclick="showSection('tutorial')"><i class="fas fa-chalkboard-teacher"></i> 1. Tutorial</button>
        <button class="nav-btn" onclick="showSection('explorer')"><i class="fas fa-flask"></i> 2. Visualizer</button>
        <button class="nav-btn" onclick="showSection('quiz')"><i class="fas fa-clipboard-check"></i> 3. Quiz</button>
        <button class="nav-btn" disabled id="nav-res"><i class="fas fa-poll"></i> 4. Results & Notes</button>
    </nav>

    <div id="tutorial" class="section active">
        <div class="slide-container">
            
            <div class="slide active-slide">
                <h2>1. Structure 2.3.1: The Lattice</h2>
                <p>To master this topic, you must visualize the structure correctly. A metal is <strong>NOT</strong> individual atoms floating around.</p>
                <p><strong>Definition:</strong> Metallic bonding is the electrostatic attraction between a lattice of <strong>Positive Ions (Cations)</strong> and <strong>Delocalized Electrons</strong>.</p>
                
                <div class="lattice-container" id="anim-container"></div>
                
                <div style="background:#fffbeb; padding:10px; border-radius:5px; border-left:4px solid #f59e0b;">
                    <strong>IB Exam Warning:</strong> Never mention "protons" or "neutral atoms" when describing the lattice. Always use the term "Cations".
                </div>
            </div>

            <div class="slide">
                <h2>Checkpoint 1: The Definition</h2>
                <div class="checkpoint-box">
                    <p><strong>Q: Which statement correctly describes the metallic bond?</strong></p>
                    <button class="opt-btn" onclick="checkCheckpoint(this, false)">Attraction between nuclei and shared electron pairs.</button>
                    <button class="opt-btn" onclick="checkCheckpoint(this, true)">Attraction between positive ions and delocalized electrons.</button>
                    <button class="opt-btn" onclick="checkCheckpoint(this, false)">Attraction between positive and negative ions.</button>
                    <p class="feedback" style="display:none; font-weight:bold; margin-top:10px;"></p>
                </div>
            </div>

            <div class="slide">
                <h2>2. Structure 2.3.2: Predicting Bond Strength</h2>
                <p>You will often be asked to compare Melting Points (e.g., Na vs Mg). Use this 3-step mental checklist:</p>
                
                <div class="step-grid">
                    <div class="step-card">
                        <h3>1. Charge</h3>
                        <p>Higher Charge = Stronger Attraction.<br>Al<sup>3+</sup> > Mg<sup>2+</sup> > Na<sup>+</sup></p>
                    </div>
                    <div class="step-card">
                        <h3>2. Radius</h3>
                        <p>Smaller Radius = Stronger Attraction.<br>Electrons are closer to the nucleus.</p>
                    </div>
                    <div class="step-card">
                        <h3>3. Density</h3>
                        <p>More delocalized electrons per atom creates a "stickier" glue holding the lattice.</p>
                    </div>
                </div>
            </div>

            <div class="slide">
                <h2>Checkpoint 2: Applying Trends</h2>
                <div class="checkpoint-box">
                    <p><strong>Q: Based on the checklist, which metal has the highest melting point?</strong></p>
                    <button class="opt-btn" onclick="checkCheckpoint(this, false)">Potassium (K): Charge +1, Large Radius</button>
                    <button class="opt-btn" onclick="checkCheckpoint(this, true)">Magnesium (Mg): Charge +2, Small Radius</button>
                    <button class="opt-btn" onclick="checkCheckpoint(this, false)">Sodium (Na): Charge +1, Medium Radius</button>
                    <p class="feedback" style="display:none; font-weight:bold; margin-top:10px;"></p>
                </div>
            </div>

            <div class="slide-footer">
                <div class="slide-dots">
                    <div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
                </div>
                <div>
                    <button class="nav-btn" onclick="changeSlide(-1)">Back</button>
                    <button class="nav-btn" style="background:var(--primary); color:white;" onclick="changeSlide(1)">Next</button>
                </div>
            </div>
        </div>
    </div>

    <div id="explorer" class="section">
        <div class="q-card">
            <h2><i class="fas fa-search"></i> Interactive Trends Visualizer</h2>
            <p>Select elements to see how <strong>Charge</strong> and <strong>Radius</strong> affect properties. Notice how the ion is smaller than the atom.</p>
            
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
                <div>
                    <div class="pt-grid">
                        <div class="element-box g1" style="grid-column:1" onclick="loadElement(this, 'Li')">Li</div>
                        <div class="element-box g2" style="grid-column:2" onclick="loadElement(this, 'Be')">Be</div>
                        
                        <div class="element-box g1" style="grid-column:1" onclick="loadElement(this, 'Na')">Na</div>
                        <div class="element-box g2" style="grid-column:2" onclick="loadElement(this, 'Mg')">Mg</div>
                        <div class="element-box g13" style="grid-column:13" onclick="loadElement(this, 'Al')">Al</div>

                        <div class="element-box g1" style="grid-column:1" onclick="loadElement(this, 'K')">K</div>
                        <div class="element-box g2" style="grid-column:2" onclick="loadElement(this, 'Ca')">Ca</div>
                        <div class="element-box tm" style="grid-column:3" onclick="loadElement(this, 'Sc')">Sc</div>
                        <div class="element-box tm" style="grid-column:4" onclick="loadElement(this, 'Ti')">Ti</div>
                        <div class="element-box tm" style="grid-column:5" onclick="loadElement(this, 'V')">V</div>
                        <div class="element-box tm" style="grid-column:6" onclick="loadElement(this, 'Cr')">Cr</div>
                        <div class="element-box tm" style="grid-column:7" onclick="loadElement(this, 'Mn')">Mn</div>
                        <div class="element-box tm" style="grid-column:8" onclick="loadElement(this, 'Fe')">Fe</div>
                        <div class="element-box tm" style="grid-column:9" onclick="loadElement(this, 'Co')">Co</div>
                        <div class="element-box tm" style="grid-column:10" onclick="loadElement(this, 'Ni')">Ni</div>
                        <div class="element-box tm" style="grid-column:11" onclick="loadElement(this, 'Cu')">Cu</div>
                        <div class="element-box tm" style="grid-column:12" onclick="loadElement(this, 'Zn')">Zn</div>
                        <div class="element-box g13" style="grid-column:13" onclick="loadElement(this, 'Ga')">Ga</div>
                    </div>
                </div>

                <div style="background: #f8fafc; padding: 20px; border-radius: 10px; text-align: center; border: 1px solid #e2e8f0;">
                    <h2 id="lab-sym" style="margin:0; font-size: 3rem; color: var(--primary);">Na</h2>
                    <h4 id="lab-name" style="margin:0; color: #64748b;">Sodium</h4>
                    
                    <div class="viz-container">
                        <div style="text-align: center;">
                            <div id="viz-atom" class="circle" style="background:#94a3b8; width:60px; height:60px;"></div>
                            <small>Atom</small>
                        </div>
                        <div style="font-size:1.5rem;">➔</div>
                        <div style="text-align: center;">
                            <div id="viz-ion" class="circle" style="background:var(--primary); width:40px; height:40px;">+1</div>
                            <small>Ion</small>
                        </div>
                    </div>

                    <div style="text-align: left; margin-top: 15px; font-size: 0.9rem;">
                        <p><strong>Charge:</strong> <span id="lab-charge">+1</span></p>
                        <p><strong>Melting Point:</strong> <span id="lab-mp">98 °C</span></p>
                        <p id="lab-desc" style="color: #475569; font-style: italic; border-top:1px solid #eee; padding-top:10px;">Large radius, low charge. Weak bond.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="quiz" class="section">
        <div class="quiz-layout">
            <div class="q-card">
                <div style="display: flex; justify-content: space-between; margin-bottom: 20px; border-bottom:1px solid #eee; padding-bottom:10px;">
                    <span id="q-progress" style="font-weight:bold; color:var(--primary);">Question 1/15</span>
                    <span id="q-score">Score: 0</span>
                </div>
                
                <h3 id="q-text" style="font-size: 1.2rem; margin-bottom: 20px;">Question goes here...</h3>
                
                <div id="q-options"></div>
                
                <div id="q-feedback" style="margin-top: 20px; padding: 15px; border-radius: 8px; display:none;"></div>
                
                <button id="btn-next-q" class="nav-btn" style="margin-top: 20px; background: var(--primary); color: white; display:none; width: 100%; justify-content: center;" onclick="nextQuestion()">Next Question</button>
            </div>
        </div>
    </div>

    <div id="results" class="section">
        <div style="text-align: center; margin-bottom: 30px;" class="print-hide">
            <h2>Quiz Complete!</h2>
            <div style="font-size: 4rem; font-weight: bold; color: var(--primary);" id="final-score">--/15</div>
            <p>Review your personalized study plan below.</p>
            <button class="nav-btn" style="background: #475569; color: white; margin: 0 auto;" onclick="window.print()"><i class="fas fa-file-pdf"></i> Download Study Notes (PDF)</button>
        </div>

        <div id="study-notes">
            <h2 style="border-bottom: 2px solid var(--primary); padding-bottom: 10px; color:var(--primary);">Metallic Bonding Study Notes</h2>
            <p><strong>Date:</strong> <span id="date-display"></span></p>
            <p><strong>Score:</strong> <span id="print-score"></span></p>

            <div id="dynamic-feedback"></div>

            <div class="result-card">
                <h3><i class="fas fa-star"></i> Summary of Key Concepts (Structure 2.3)</h3>
                <ul>
                    <li><strong>Definition:</strong> Metallic bonding is the electrostatic attraction between a lattice of positive ions and delocalized electrons.</li>
                    <li><strong>Properties:</strong>
                        <ul>
                            <li>Conductivity: Due to mobile delocalized electrons.</li>
                            <li>Malleability: Non-directional bonding allows ion layers to slide over each other.</li>
                        </ul>
                    </li>
                    <li><strong>Strength Trends:</strong>
                        <ul>
                            <li><strong>Across Period (e.g., Na -> Al):</strong> Strength Increases (Charge ↑, Radius ↓).</li>
                            <li><strong>Down Group (e.g., Li -> Cs):</strong> Strength Decreases (Radius ↑, Charge constant).</li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </div>

</div>

<script>
    // --- REVISION VILLAGE INSPIRED QUESTIONS (Exact Match) ---
    const quizData = [
        { 
            t: "1. Which metal has the strongest metallic bonding?", 
            o: ["Li (Lithium)", "K (Potassium)", "Rb (Rubidium)", "Cs (Caesium)"], 
            a: 0, 
            tag: "Structure 2.3.2", 
            exp: "<strong>Correct!</strong> (Ref: Q15) Bond strength decreases down Group 1 as ionic radius increases. Li is at the top (smallest radius), so it has the strongest attraction." 
        },
        { 
            t: "2. Which combination corresponds to a strong metallic bond?", 
            o: ["Charge: Large, Radius: Large", "Charge: Large, Radius: Small", "Charge: Small, Radius: Small", "Charge: Small, Radius: Large"], 
            a: 1, 
            tag: "Structure 2.3.2", 
            exp: "<strong>Correct!</strong> (Ref: Q9) According to Coulomb's law, attraction is strongest with a high charge and a small ionic radius." 
        },
        { 
            t: "3. Which of the following explains why Aluminium has a higher melting point than Magnesium?<br><br>I. Al contains more delocalized electrons per ion.<br>II. The ionic radius of Al³⁺ is smaller than Mg²⁺.<br>III. The charge of Al³⁺ is greater than Mg²⁺.", 
            o: ["I only", "II and III only", "II only", "I, II and III"], 
            a: 3, 
            tag: "Trends", 
            exp: "<strong>Correct!</strong> (Ref: Q12) All three factors contribute. Al has more delocalized electrons (3 vs 2), a higher charge (+3 vs +2), and a smaller radius. This creates a much stronger lattice." 
        },
        { 
            t: "4. Increasing which factor will increase the strength of a metallic bond?", 
            o: ["The quantity of delocalized electrons", "The density of the metal", "The electronegativity of the metal atoms", "The number of energy levels (shells)"], 
            a: 0, 
            tag: "Structure 2.3.2", 
            exp: "<strong>Correct!</strong> (Ref: Q23) More delocalized electrons increase the electrostatic attraction between the lattice and the 'sea'." 
        },
        { 
            t: "5. Based on periodic trends, which series correctly orders the elements by INCREASING melting points?", 
            o: ["Rb < Sr < Zr < Cs", "Cs < Zr < Sr < Rb", "Cs < Rb < Sr < Zr", "Zr < Sr < Rb < Cs"], 
            a: 2, 
            tag: "Trends", 
            exp: "<strong>Correct!</strong> (Ref: Q21) <br>1. Cs < Rb (Group 1 trend: MP decreases down group).<br>2. Rb < Sr (Period 5 trend: Group 1 < Group 2).<br>3. Sr < Zr (Transition metals form stronger bonds due to d-electrons)." 
        },
        { 
            t: "6. Which characteristic best corresponds to, or indicates, the strength of metallic bonding?", 
            o: ["Electron affinity", "Electronegativity", "Ionic radius", "Melting Point"], 
            a: 3, 
            tag: "Properties", 
            exp: "<strong>Correct!</strong> (Ref: Q6) Melting Point is the direct physical observable that indicates how much energy is required to break the lattice attraction." 
        },
        { 
            t: "7. Explain the electrical conductivity of Copper in terms of its structure (Ref: Q22).", 
            o: ["Copper ions move to the negative electrode", "Delocalized electrons are free to move and carry charge", "Copper has a high density of protons", "Copper atoms vibrate faster"], 
            a: 1, 
            tag: "Properties", 
            exp: "<strong>Correct!</strong> In a solid metal lattice, the ions are fixed. Conductivity is solely due to the mobility of the delocalized valence electrons." 
        },
        { 
            t: "8. Titanium (MP: 1670°C) has a much higher melting point than Lithium (MP: 181°C). Which statement best explains this in terms of atomic structure?", 
            o: ["Ti has a larger atomic mass", "Ti forms a lattice with covalent character", "Ti has a higher ionic charge and involves d-electrons in bonding", "Ti has a larger ionic radius"], 
            a: 2, 
            tag: "Structure 2.3.1", 
            exp: "<strong>Correct!</strong> (Ref: Q17) Titanium is a transition metal. It forms ions with high charge and uses 3d-electrons in the delocalized sea, creating a much stronger bond than Group 1 Lithium." 
        },
        { 
            t: "9. Based on periodic trends, which element is expected to have the highest boiling point?", 
            o: ["Lithium (Li)", "Beryllium (Be)", "Potassium (K)", "Calcium (Ca)"], 
            a: 1, 
            tag: "Trends", 
            exp: "<strong>Correct!</strong> (Ref: Q18) Beryllium (Be) is in Group 2 and Period 2. It has a +2 charge and the smallest radius of the options, leading to the strongest bond." 
        },
        { 
            t: "10. Why is the metallic bond in Magnesium stronger than in Sodium?", 
            o: ["Mg has a larger radius", "Mg contributes 2 electrons per atom vs 1 for Na", "Na has a higher electronegativity", "Mg is a transition metal"], 
            a: 1, 
            tag: "Trends", 
            exp: "<strong>Correct!</strong> Mg forms a +2 ion and contributes two electrons to the sea, whereas Na forms +1 and contributes only one." 
        },
        { 
            t: "11. Which definition matches the metallic lattice?", 
            o: ["Positive ions in a sea of electrons", "Negative ions in a sea of protons", "Neutral atoms sharing electrons", "Electrostatic attraction between nuclei"], 
            a: 0, 
            tag: "Structure 2.3.1", 
            exp: "<strong>Correct!</strong> This is the fundamental definition from Structure 2.3.1." 
        },
        { 
            t: "12. Why are metals malleable?", 
            o: ["The electrons are fixed in place", "Non-directional bonding allows layers to slide", "The ionic lattice is brittle", "The bonds break easily"], 
            a: 1, 
            tag: "Properties", 
            exp: "<strong>Correct!</strong> The mobile electron sea maintains the bond even when ion layers slide past one another." 
        },
        { 
            t: "13. Which element has the largest ionic radius (and weakest bond) in this list?", 
            o: ["Li", "Na", "K", "Cs"], 
            a: 3, 
            tag: "Trends", 
            exp: "<strong>Correct!</strong> Caesium (Cs) is at the bottom of Group 1. It has the most electron shells, largest radius, and thus the weakest attraction." 
        },
        { 
            t: "14. Which substance conducts electricity in both solid and molten states?", 
            o: ["NaCl (Ionic)", "Copper (Metallic)", "Sulfur (Simple Molecular)", "SiO2 (Giant Covalent)"], 
            a: 1, 
            tag: "Properties", 
            exp: "<strong>Correct!</strong> Metals conduct in both states. Ionic compounds (like NaCl) only conduct when molten or dissolved." 
        },
        { 
            t: "15. Alloys are generally harder than pure metals because:", 
            o: ["They contain covalent bonds", "Different sized atoms disrupt the lattice layers", "They have fewer electrons", "They are less dense"], 
            a: 1, 
            tag: "Alloys", 
            exp: "<strong>Correct!</strong> The disruption of the regular lattice prevents layers from sliding, reducing malleability and increasing hardness." 
        }
    ];

    // --- ELEMENT DATA ---
    const elements = {
        'Li': { rA: 152, rI: 76, c: '+1', mp: 180, desc: 'Smallest G1. Strongest of alkali metals.' },
        'Na': { rA: 186, rI: 102, c: '+1', mp: 98, desc: 'Weak bond due to +1 charge and medium size.' },
        'Mg': { rA: 160, rI: 72, c: '+2', mp: 650, desc: 'Stronger than Na due to +2 charge.' },
        'Al': { rA: 143, rI: 54, c: '+3', mp: 660, desc: 'Very strong. High charge density.' },
        'K': { rA: 227, rI: 138, c: '+1', mp: 63, desc: 'Large radius = Weak bond = Low MP.' },
        'Ca': { rA: 197, rI: 100, c: '+2', mp: 842, desc: 'Harder than K, softer than Mg.' },
        'Fe': { rA: 126, rI: 65, c: 'Var', mp: 1538, desc: 'Transition metal. D-electrons add strength.' },
        'Cu': { rA: 128, rI: 73, c: 'Var', mp: 1085, desc: 'Good conductor.' },
        'Zn': { rA: 134, rI: 74, c: '+2', mp: 419, desc: 'Full d-shell, weaker than Fe.' },
        'Be': { rA: 112, rI: 45, c: '+2', mp: 1287, desc: 'Tiny radius, very strong.' },
        'Sc': { rA: 162, rI: 74, c: '+3', mp: 1541, desc: 'Standard transition metal strength.' },
        'Ti': { rA: 147, rI: 61, c: '+4', mp: 1668, desc: 'Very strong, used in aerospace.' },
        'V': { rA: 134, rI: 59, c: '+5', mp: 1910, desc: 'Very hard.' },
        'Cr': { rA: 128, rI: 61, c: 'Var', mp: 1907, desc: 'High MP.' },
        'Mn': { rA: 127, rI: 67, c: 'Var', mp: 1246, desc: 'Complex structure.' },
        'Co': { rA: 125, rI: 65, c: '+2', mp: 1495, desc: 'Similar to Iron.' },
        'Ni': { rA: 124, rI: 69, c: '+2', mp: 1455, desc: 'Strong.' },
        'Ga': { rA: 135, rI: 62, c: '+3', mp: 30, desc: 'Low MP, High BP liquid range.' }
    };

    // --- LOGIC ---
    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        if(id === 'tutorial') document.querySelector('.nav-btn:nth-child(1)').classList.add('active');
        if(id === 'explorer') document.querySelector('.nav-btn:nth-child(2)').classList.add('active');
        if(id === 'quiz') document.querySelector('.nav-btn:nth-child(3)').classList.add('active');
        if(id === 'results') document.querySelector('.nav-btn:nth-child(4)').classList.add('active');
    }

    // Tutorial Slides
    let slideIdx = 0;
    function changeSlide(dir) {
        const slides = document.querySelectorAll('.slide');
        const dots = document.querySelectorAll('.dot');
        
        slides[slideIdx].classList.remove('active-slide');
        dots[slideIdx].classList.remove('active');
        
        slideIdx += dir;
        if(slideIdx < 0) slideIdx = 0;
        if(slideIdx >= slides.length) slideIdx = slides.length - 1;
        
        slides[slideIdx].classList.add('active-slide');
        dots[slideIdx].classList.add('active');
    }

    function checkCheckpoint(btn, isCorrect) {
        const parent = btn.parentElement;
        const feedback = parent.querySelector('.feedback');
        if(isCorrect) {
            btn.style.background = "#dcfce7"; 
            feedback.innerText = "Correct! Well done.";
            feedback.style.color = "#059669";
        } else {
            btn.style.background = "#fee2e2"; 
            feedback.innerText = "Incorrect. Try again!";
            feedback.style.color = "#dc2626";
        }
        feedback.style.display = "block";
    }

    // Animation
    function initAnimation() {
        const container = document.getElementById('anim-container');
        // Create Ions
        for(let i=0; i<3; i++) {
            for(let j=0; j<8; j++) {
                const ion = document.createElement('div');
                ion.className = 'metal-ion';
                ion.innerText = '+';
                ion.style.top = (i*50 + 20) + 'px';
                ion.style.left = (j*50 + 20) + 'px';
                container.appendChild(ion);
            }
        }
        // Create Electrons
        for(let k=0; k<25; k++) {
            const e = document.createElement('div');
            e.className = 'electron';
            e.style.top = Math.random()*150 + 'px';
            e.style.left = Math.random()*400 + 'px';
            e.style.animationDelay = Math.random() + 's';
            container.appendChild(e);
        }
    }

    // Explorer Logic
    function loadElement(el, sym) {
        const d = elements[sym];
        if(!d) return;
        
        document.getElementById('lab-sym').innerText = sym;
        document.getElementById('lab-name').innerText =
            (sym === 'Na') ? 'Sodium' :
            (sym === 'Mg') ? 'Magnesium' :
            (sym === 'Al') ? 'Aluminium' :
            (sym === 'Li') ? 'Lithium' :
            (sym === 'K') ? 'Potassium' :
            (sym === 'Ca') ? 'Calcium' :
            (sym === 'Be') ? 'Beryllium' :
            'Element';

        document.getElementById('lab-charge').innerText = d.c;
        document.getElementById('lab-mp').innerText = d.mp + " °C";
        document.getElementById('lab-desc').innerText = d.desc;

        const atom = document.getElementById('viz-atom');
        const ion = document.getElementById('viz-ion');
        
        // Visual Scaling
        atom.style.width = (d.rA * 0.6) + 'px';
        atom.style.height = (d.rA * 0.6) + 'px';
        ion.style.width = (d.rI * 0.6) + 'px';
        ion.style.height = (d.rI * 0.6) + 'px';
        ion.innerText = d.c;
        
        document.querySelectorAll('.element-box').forEach(b => b.classList.remove('selected'));
        if (el) {
            el.classList.add('selected');
        }
    }

    // Quiz Logic
    let qIdx = 0;
    let score = 0;
    let mistakes = [];
    let wrongQuestions = [];  // store indices of wrong questions

    function loadQuiz() {
        if(qIdx >= quizData.length) {
            finishQuiz();
            return;
        }
        
        const q = quizData[qIdx];
        document.getElementById('q-progress').innerText = `Question ${qIdx+1} / ${quizData.length}`;
        document.getElementById('q-score').innerText = `Score: ${score}`;
        
        // Allow HTML & MathJax in question text
        document.getElementById('q-text').innerHTML = q.t;
        const feedbackEl = document.getElementById('q-feedback');
        feedbackEl.style.display = 'none';
        document.getElementById('btn-next-q').style.display = 'none';
        
        const container = document.getElementById('q-options');
        container.innerHTML = '';
        
        q.o.forEach((opt, i) => {
            const btn = document.createElement('button');
            btn.className = 'opt-btn';
            // Allow HTML in options
            btn.innerHTML = opt;
            btn.onclick = () => answerQuiz(i, btn);
            container.appendChild(btn);
        });

        // Re-typeset math if MathJax is available
        if (window.MathJax && MathJax.typesetPromise) {
            MathJax.typesetPromise([
                document.getElementById('q-text'),
                document.getElementById('q-options')
            ]).catch(() => {});
        }
    }

    function answerQuiz(i, btn) {
        const q = quizData[qIdx];
        const allBtns = document.querySelectorAll('#quiz .opt-btn');
        allBtns.forEach(b => b.disabled = true);
        const fb = document.getElementById('q-feedback');
        
        if(i === q.a) {
            btn.classList.add('correct');
            score++;
            fb.innerHTML = `<span style="color:#059669; font-weight:bold">Correct!</span> ${q.exp}`;
            fb.style.background = "#dcfce7";
            fb.style.border = "1px solid #059669";
        } else {
            btn.classList.add('wrong');
            allBtns[q.a].classList.add('correct');
            mistakes.push(q.tag);
            wrongQuestions.push(qIdx);  // record this question as missed
            fb.innerHTML = `<span style="color:#dc2626; font-weight:bold">Incorrect.</span> ${q.exp}`;
            fb.style.background = "#fee2e2";
            fb.style.border = "1px solid #dc2626";
        }
        fb.style.display = 'block';
        document.getElementById('btn-next-q').style.display = 'block';
    }

    function nextQuestion() {
        qIdx++;
        loadQuiz();
    }

    function finishQuiz() {
        showSection('results');
        document.getElementById('nav-res').disabled = false;
        document.getElementById('final-score').innerText = `${score} / ${quizData.length}`;
        document.getElementById('print-score').innerText = `${score} / ${quizData.length}`;
        document.getElementById('date-display').innerText = new Date().toLocaleDateString();
        generateStudyNotes();
    }

    function generateStudyNotes() {
        const container = document.getElementById('dynamic-feedback');
        const uniqueMistakes = [...new Set(mistakes)];
        
        let html = '';
        if(score === quizData.length) {
            html += `<div class="result-card" style="border-color:#059669"><h3><i class="fas fa-check-circle"></i> Mastery Achieved!</h3><p>You have answered all questions correctly. You are ready for IB questions on this topic.</p></div>`;
        } else {
            html += `<p>Focus your revision on the following:</p>`;
            if(uniqueMistakes.includes('Structure 2.3.1')) {
                html += `<div class="result-card"><span class="mistake-tag">Structure 2.3.1</span> <strong>Lattice Model:</strong> Review the definition of the lattice and the role of delocalized electrons. Remember: "Cations in a sea of electrons".</div>`;
            }
            if(uniqueMistakes.includes('Structure 2.3.2') || uniqueMistakes.includes('Trends')) {
                html += `<div class="result-card"><span class="mistake-tag">Structure 2.3.2</span> <strong>Melting Point Trends:</strong> Remember the rule: Strength is proportional to Charge divided by Radius. (Mg is stronger than Na).</div>`;
            }
            if(uniqueMistakes.includes('Properties') || uniqueMistakes.includes('Alloys')) {
                html += `<div class="result-card"><span class="mistake-tag">Properties</span> <strong>Explanations:</strong> Focus on "non-directional bonding" (Malleability) and "mobile charge carriers" (Conductivity).</div>`;
            }

            // Detailed list of missed questions
            const uniqueWrong = [...new Set(wrongQuestions)];
            if (uniqueWrong.length > 0) {
                html += `<div class="result-card">
                            <h3><i class="fas fa-list-ul"></i> Questions to Review</h3>
                            <p>Each question shows its number, topic, and the original prompt so you can target your revision.</p>
                            <ol>`;
                uniqueWrong.forEach(idx => {
                    const q = quizData[idx];
                    html += `<li>
                                <span class="mistake-tag">Q${idx + 1}</span>
                                <strong>${q.tag}</strong><br>
                                <span>${q.t}</span>
                             </li>`;
                });
                html += `   </ol>
                         </div>`;
            }
        }
        container.innerHTML = html;
    }

    // Init
    initAnimation();
    // Set default element to Na and highlight it
    const defaultNa = document.querySelector('.element-box[onclick*="Na"]');
    loadElement(defaultNa, 'Na');
    loadQuiz();
</script>

</body>
</html>
